-- ===================================
-- 学霸神器数仓 - 权限系统示例数据
-- 用于验证权限机制的各种场景
-- ===================================

USE data_ware_test;

-- ===================================
-- 1. 组织架构示例数据
-- ===================================

-- 插入组织树数据（基于你提供的图）
INSERT INTO 组织树维度 (组织ID, 组织名称, 组织类型, 父节点ID, 组织路径, 组织层级, 学段, 年级, 排序号) VALUES
-- 学校层级
('1000', '博雅中学', '学校', NULL, '1000', 1, NULL, NULL, 1),

-- 学部层级  
('1100', '高中部', '学部', '1000', '1000/1100', 2, '高中', NULL, 1),

-- 年级层级
('1110', '高一年级', '年级', '1100', '1000/1100/1110', 3, '高中', '高一', 1),
('1120', '高二年级', '年级', '1100', '1000/1100/1120', 3, '高中', '高二', 2), 
('1130', '高三年级', '年级', '1100', '1000/1100/1130', 3, '高中', '高三', 3),

-- 班级层级
('1111', '高一一班', '班级', '1110', '1000/1100/1110/1111', 4, '高中', '高一', 1),
('1112', '高一二班', '班级', '1110', '1000/1100/1110/1112', 4, '高中', '高一', 2),
('1113', '高一三班', '班级', '1110', '1000/1100/1110/1113', 4, '高中', '高一', 3),
('1121', '高二一班', '班级', '1120', '1000/1100/1120/1121', 4, '高中', '高二', 1),
('1122', '高二二班', '班级', '1120', '1000/1100/1120/1122', 4, '高中', '高二', 2),
('1123', '高二三班', '班级', '1120', '1000/1100/1120/1123', 4, '高中', '高二', 3),
('1131', '高三一班', '班级', '1130', '1000/1100/1130/1131', 4, '高中', '高三', 1),
('1132', '高三二班', '班级', '1130', '1000/1100/1130/1132', 4, '高中', '高三', 2),
('1133', '高三三班', '班级', '1130', '1000/1100/1130/1133', 4, '高中', '高三', 3);

-- ===================================
-- 2. 角色定义示例数据
-- ===================================

INSERT INTO 角色定义表 (角色ID, 角色名称, 角色类型, 角色描述, 是否系统内置, 权限级别) VALUES
('R001', '系统管理员', '系统角色', '拥有系统最高权限', TRUE, 9),
('R002', '校长', '业务角色', '学校管理者，拥有学校级别权限', TRUE, 8),
('R003', '学部主任', '业务角色', '学部管理者，拥有学部级别权限', TRUE, 7),
('R004', '年级主任', '业务角色', '年级管理者，拥有年级级别权限', TRUE, 6),
('R005', '班主任', '业务角色', '班级管理者，拥有班级级别权限', TRUE, 5),
('R006', '任课教师', '业务角色', '普通任课教师', TRUE, 4),
('R007', '代课教师', '业务角色', '临时代课教师', TRUE, 3),
('R008', '实习教师', '业务角色', '实习期教师', TRUE, 2),
('R009', '学生', '业务角色', '学生用户', TRUE, 1);

-- ===================================
-- 3. 权限定义示例数据
-- ===================================

INSERT INTO 权限定义表 (权限ID, 权限名称, 权限类型, 资源类型, 操作类型, 权限代码, 权限描述, 是否系统内置) VALUES
-- 题目相关权限
('P001', '查看题目', '数据权限', '题目', '查看', 'question:view', '查看题目内容和信息', TRUE),
('P002', '编辑题目', '数据权限', '题目', '编辑', 'question:edit', '编辑题目内容', TRUE),
('P003', '删除题目', '数据权限', '题目', '删除', 'question:delete', '删除题目', TRUE),
('P004', '分享题目', '数据权限', '题目', '分享', 'question:share', '分享题目给其他用户', TRUE),
('P005', '题目所有权', '数据权限', '题目', '管理', 'question:own', '题目所有权，可进行所有操作', TRUE),

-- 试卷相关权限
('P011', '查看试卷', '数据权限', '试卷', '查看', 'paper:view', '查看试卷内容', TRUE),
('P012', '编辑试卷', '数据权限', '试卷', '编辑', 'paper:edit', '编辑试卷内容', TRUE),
('P013', '删除试卷', '数据权限', '试卷', '删除', 'paper:delete', '删除试卷', TRUE),

-- 成绩相关权限
('P021', '查看成绩', '数据权限', '成绩', '查看', 'score:view', '查看学生成绩', TRUE),
('P022', '编辑成绩', '数据权限', '成绩', '编辑', 'score:edit', '修改学生成绩', TRUE),

-- 学生管理权限
('P031', '查看学生信息', '数据权限', '学生', '查看', 'student:view', '查看学生基本信息', TRUE),
('P032', '管理学生', '数据权限', '学生', '管理', 'student:manage', '管理学生信息', TRUE),

-- 班级管理权限
('P041', '查看班级信息', '数据权限', '班级', '查看', 'class:view', '查看班级信息', TRUE),
('P042', '管理班级', '数据权限', '班级', '管理', 'class:manage', '管理班级信息', TRUE);

-- ===================================
-- 4. 角色权限桥接示例数据
-- ===================================

INSERT INTO 角色权限桥接表 (桥接ID, 角色ID, 权限ID, 是否继承) VALUES
-- 系统管理员：拥有所有权限
('RP001', 'R001', 'P001', TRUE), ('RP002', 'R001', 'P002', TRUE), ('RP003', 'R001', 'P003', TRUE),
('RP004', 'R001', 'P004', TRUE), ('RP005', 'R001', 'P005', TRUE), ('RP006', 'R001', 'P011', TRUE),
('RP007', 'R001', 'P012', TRUE), ('RP008', 'R001', 'P013', TRUE), ('RP009', 'R001', 'P021', TRUE),
('RP010', 'R001', 'P022', TRUE), ('RP011', 'R001', 'P031', TRUE), ('RP012', 'R001', 'P032', TRUE),
('RP013', 'R001', 'P041', TRUE), ('RP014', 'R001', 'P042', TRUE),

-- 校长：学校级别权限
('RP015', 'R002', 'P001', TRUE), ('RP016', 'R002', 'P002', TRUE), ('RP017', 'R002', 'P011', TRUE),
('RP018', 'R002', 'P012', TRUE), ('RP019', 'R002', 'P021', TRUE), ('RP020', 'R002', 'P031', TRUE),
('RP021', 'R002', 'P041', TRUE), ('RP022', 'R002', 'P042', TRUE),

-- 任课教师：基础教学权限
('RP023', 'R006', 'P001', TRUE), ('RP024', 'R006', 'P002', TRUE), ('RP025', 'R006', 'P004', TRUE),
('RP026', 'R006', 'P011', TRUE), ('RP027', 'R006', 'P012', TRUE), ('RP028', 'R006', 'P021', TRUE),
('RP029', 'R006', 'P031', TRUE),

-- 班主任：班级管理权限
('RP030', 'R005', 'P001', TRUE), ('RP031', 'R005', 'P002', TRUE), ('RP032', 'R005', 'P004', TRUE),
('RP033', 'R005', 'P011', TRUE), ('RP034', 'R005', 'P012', TRUE), ('RP035', 'R005', 'P021', TRUE),
('RP036', 'R005', 'P022', TRUE), ('RP037', 'R005', 'P031', TRUE), ('RP038', 'R005', 'P032', TRUE),
('RP039', 'R005', 'P041', TRUE), ('RP040', 'R005', 'P042', TRUE);

-- ===================================
-- 5. 用户示例数据
-- ===================================

INSERT INTO 个人维度 (用户ID, 用户类型, 用户名, 真实姓名, 性别, 主要学科, 职称, 工号, 账户状态) VALUES
-- 管理员和校长
('U001', '管理员', 'admin', '系统管理员', '男', NULL, NULL, 'A001', '正常'),
('U002', '教师', 'principal', '张校长', '男', NULL, '校长', 'P001', '正常'),

-- 学部和年级主任
('U003', '教师', 'dept_director', '李主任', '女', NULL, '学部主任', 'D001', '正常'),
('U004', '教师', 'grade1_director', '王主任', '男', NULL, '年级主任', 'G001', '正常'),
('U005', '教师', 'grade2_director', '赵主任', '女', NULL, '年级主任', 'G002', '正常'),

-- 班主任
('U006', '教师', 'class1_teacher', '刘老师', '女', '语文', '高级教师', 'T001', '正常'),
('U007', '教师', 'class2_teacher', '陈老师', '男', '数学', '中级教师', 'T002', '正常'),

-- 任课教师（跨班级）
('U008', '教师', 'math_teacher', '孙老师', '女', '数学', '高级教师', 'T003', '正常'),
('U009', '教师', 'english_teacher', '周老师', '男', '英语', '中级教师', 'T004', '正常'),

-- 代课教师
('U010', '教师', 'substitute_teacher', '吴老师', '女', '物理', '初级教师', 'T005', '正常'),

-- 学生
('U011', '学生', 'student1', '小明', '男', NULL, NULL, NULL, '正常'),
('U012', '学生', 'student2', '小红', '女', NULL, NULL, NULL, '正常');

-- ===================================
-- 6. 用户组织关系示例数据
-- ===================================

INSERT INTO 用户组织关系表 (关系ID, 用户ID, 组织ID, 组织路径, 关系类型, 角色ID, 是否主要角色) VALUES
-- 系统管理员
('UR001', 'U001', '1000', '1000', '主要归属', 'R001', TRUE),

-- 校长
('UR002', 'U002', '1000', '1000', '主要归属', 'R002', TRUE),

-- 学部主任
('UR003', 'U003', '1100', '1000/1100', '主要归属', 'R003', TRUE),

-- 年级主任
('UR004', 'U004', '1110', '1000/1100/1110', '主要归属', 'R004', TRUE),
('UR005', 'U005', '1120', '1000/1100/1120', '主要归属', 'R004', TRUE),

-- 班主任
('UR006', 'U006', '1111', '1000/1100/1110/1111', '主要归属', 'R005', TRUE),
('UR007', 'U007', '1112', '1000/1100/1110/1112', '主要归属', 'R005', TRUE),

-- 跨班级任课教师（孙老师：数学老师，教高一二班和高二三班）
('UR008', 'U008', '1112', '1000/1100/1110/1112', '任课关系', 'R006', TRUE),
('UR009', 'U008', '1123', '1000/1100/1120/1123', '任课关系', 'R006', FALSE),

-- 英语老师（周老师：教高一一班和高一三班）
('UR010', 'U009', '1111', '1000/1100/1110/1111', '任课关系', 'R006', TRUE),
('UR011', 'U009', '1113', '1000/1100/1110/1113', '任课关系', 'R006', FALSE),

-- 代课教师（临时权限，有失效时间）
('UR012', 'U010', '1121', '1000/1100/1120/1121', '临时权限', 'R007', TRUE),

-- 学生
('UR013', 'U011', '1111', '1000/1100/1110/1111', '主要归属', 'R009', TRUE),
('UR014', 'U012', '1112', '1000/1100/1110/1112', '主要归属', 'R009', TRUE);

-- 设置代课教师的临时权限失效时间（3个月后）
UPDATE 用户组织关系表 SET 失效时间 = DATE_ADD(NOW(), INTERVAL 3 MONTH) WHERE 关系ID = 'UR012';

-- ===================================
-- 7. 题目和权限示例数据
-- ===================================

-- 模拟一些题目资源
INSERT INTO 题目操作ACL表 (ACL_ID, 资源ID, 资源类型, 授权对象类型, 授权对象ID, 权限类型, 权限范围, 是否可编辑原资源, 权限来源, 申请状态, 创建者ID) VALUES
-- 刘老师创建的题目，默认高中部共享
('ACL001', 'Q001', '题目', 'org', '1100', '查看', '1000/1100', FALSE, '默认继承', '无需申请', 'U006'),
('ACL002', 'Q001', '题目', 'user', 'U006', '所有权', '1000/1100', TRUE, '默认继承', '无需申请', 'U006'),

-- 陈老师创建的题目，只给高一二班
('ACL003', 'Q002', '题目', 'org', '1112', '查看', '1000/1100/1110/1112', FALSE, '路径权限', '无需申请', 'U007'),
('ACL004', 'Q002', '题目', 'user', 'U007', '所有权', '1000/1100/1110/1112', TRUE, '路径权限', '无需申请', 'U007'),

-- 孙老师申请查看陈老师的题目（跨班级场景）
('ACL005', 'Q002', '题目', 'user', 'U008', '查看', '1000/1100/1120/1123', FALSE, '申请获得', '待审批', 'U007');

-- ===================================
-- 8. 权限申请示例数据
-- ===================================

INSERT INTO 权限申请表 (申请ID, 申请类型, 申请者ID, 目标资源ID, 目标资源类型, 申请权限类型, 申请原因, 申请状态) VALUES
-- 孙老师申请查看陈老师的高一二班专属题目
('APP001', '资源权限', 'U008', 'Q002', '题目', '查看', '需要为高二三班学生补充同类型练习题', '待审批'),

-- 代课教师申请临时编辑权限
('APP002', '资源权限', 'U010', 'Q001', '题目', '编辑', '代课期间需要修改题目难度', '待审批');

-- ===================================
-- 9. 审计日志示例数据
-- ===================================

INSERT INTO 操作审计表 (审计ID, 操作用户ID, 操作类型, 操作对象类型, 操作对象ID, 操作描述, 操作结果, 操作IP) VALUES
('AUDIT001', 'U006', '创建', '题目', 'Q001', '刘老师创建高中数学题目', '成功', '192.168.1.100'),
('AUDIT002', 'U007', '创建', '题目', 'Q002', '陈老师创建高一二班专属题目', '成功', '192.168.1.101'),
('AUDIT003', 'U008', '查看', '题目', 'Q001', '孙老师查看高中部共享题目', '成功', '192.168.1.102'),
('AUDIT004', 'U008', '申请', '题目', 'Q002', '孙老师申请查看高一二班专属题目', '成功', '192.168.1.102');

-- ===================================
-- 10. 权限变更日志示例数据
-- ===================================

INSERT INTO 权限变更日志表 (日志ID, 变更类型, 目标用户ID, 权限变更内容, 变更原因, 操作者ID) VALUES
('LOG001', '权限授予', 'U010', '{"权限类型": "临时权限", "组织": "1121", "角色": "R007", "期限": "3个月"}', '代课需要', 'U004'),
('LOG002', '权限授予', 'U008', '{"权限类型": "任课关系", "组织": "1123", "角色": "R006"}', '跨班级任课', 'U005'); 