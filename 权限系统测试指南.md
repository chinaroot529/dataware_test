# 🧪 权限系统测试指南

## 🚀 快速开始

### 1. 访问测试系统
- **地址**: http://localhost:8080
- **状态**: Flask应用已启动，数据库已就绪
- **数据**: 50道题目，138个ACL权限记录

### 2. 测试账号列表

| 用户名 | 真实姓名 | 角色 | 权限范围 | 测试重点 |
|--------|----------|------|----------|----------|
| `admin` | 系统管理员 | 系统管理员 | 全局权限 | 最高权限验证 |
| `principal` | 张校长 | 校长 | 学校级别 | 学校层级权限 |
| `class1_teacher` | 刘老师 | 班主任 | 高一一班 | 班级权限 + 题目创建 |
| `math_teacher` | 孙老师 | 任课教师 | 跨班级 | 跨班级任课验证 |
| `substitute_teacher` | 吴老师 | 代课教师 | 临时权限 | 临时权限验证 |

## 🔍 核心测试场景

### 场景1：跨班级任课权限验证 🌟

**测试用户**: `math_teacher` (孙老师)

**预期结果**:
- 可以访问高一二班和高二三班的题目
- 拥有两个班级的基础教师权限
- 能查看但不能编辑其他班级专属题目

**测试步骤**:
1. 登录 `math_teacher`
2. 查看"我的权限"选项卡，应该看到14项权限
3. 查看题目库，筛选不同年级应该看到对应权限的题目
4. 尝试查看题目详情，验证权限控制

**验证点**:
- [ ] 权限数量：14项（7项×2个班级）
- [ ] 可访问高一和高二题目
- [ ] 无法访问高三题目（无权限）

### 场景2：班级专属权限验证 🔒

**测试用户**: `class1_teacher` (刘老师)

**预期结果**:
- 作为高一一班班主任，拥有班级管理权限
- 可以查看和编辑本班级题目
- 能看到由自己创建的题目

**测试步骤**:
1. 登录 `class1_teacher`
2. 查看统计信息，注意可访问题目数量
3. 筛选"高一"年级题目，查看权限范围
4. 查看自己创建的题目的权限信息

**验证点**:
- [ ] 拥有班主任完整权限
- [ ] 可访问高一年级题目
- [ ] 能看到自己创建的题目详情

### 场景3：临时权限管理 ⏰

**测试用户**: `substitute_teacher` (吴老师)

**预期结果**:
- 拥有高二一班的临时代课权限
- 权限有90天有效期
- 只能访问授权班级的题目

**测试步骤**:
1. 登录 `substitute_teacher`
2. 查看权限列表，确认权限状态
3. 筛选"高二"题目，验证访问范围
4. 尝试访问其他年级题目（应该被拒绝）

**验证点**:
- [ ] 只有代课教师基础权限
- [ ] 权限有明确的有效期
- [ ] 无法访问未授权的题目

### 场景4：最高权限验证 🔑

**测试用户**: `admin` (系统管理员)

**预期结果**:
- 拥有系统最高权限
- 可以访问所有题目
- 能查看所有用户信息

**测试步骤**:
1. 登录 `admin`
2. 查看统计信息，应该显示所有题目
3. 测试访问不同学科、年级、难度的题目
4. 查看题目权限信息，验证管理员权限

**验证点**:
- [ ] 可访问全部50道题目
- [ ] 拥有所有类型的权限
- [ ] 能查看详细的权限分配信息

### 场景5：权限拒绝验证 ❌

**测试场景**: 访问无权限的题目

**测试步骤**:
1. 使用普通教师账号登录
2. 尝试直接访问其他班级的专属题目
3. 查看系统返回的权限拒绝消息

**验证点**:
- [ ] 系统正确识别权限不足
- [ ] 返回适当的错误消息
- [ ] 不泄露无权限的题目内容

## 📊 数据验证检查点

### 题目分布验证
```
总题目数: 50道
- 数学: 9道
- 物理: 7道  
- 语文: 9道
- 英语: 14道
- 化学: 若干道
- 生物: 若干道

年级分布:
- 高一: 25道
- 高二: 13道
- 高三: 若干道
```

### 权限记录验证
```
ACL权限记录: 138条
- 每个题目约有2-3条权限记录
- 包含创建者所有权
- 包含组织查看权限
- 包含学段共享权限
```

## 🎯 权限机制验证

### 1. "默认开放，按需限制"
- [ ] 题目创建后默认学段可见
- [ ] 特殊题目可限制到班级级别
- [ ] 跨学段需要申请权限

### 2. "路径权限"
- [ ] 组织路径正确匹配（1000/1100/1110/1112）
- [ ] 权限向下继承（高中部→年级→班级）
- [ ] 精准权限控制

### 3. "权限叠加"
- [ ] 个人权限 + 组织权限正确合并
- [ ] 多个角色权限叠加生效
- [ ] 主要角色与兼任角色区分

### 4. "副本机制"（待实现）
- [ ] 无编辑权用户创建副本
- [ ] 有编辑权用户选择更新或创建副本

## 🛠️ 操作审计验证

### 审计日志检查
1. 查看题目时自动记录操作日志
2. 包含操作用户、时间、对象等信息
3. 支持操作追踪和安全审计

**验证方法**:
```sql
-- 查看最近的审计日志
SELECT * FROM 操作审计表 ORDER BY 操作时间 DESC LIMIT 10;
```

## 🚨 异常场景测试

### 1. 会话超时
- 长时间未操作后重新访问
- 验证重新登录流程

### 2. 权限变更
- 用户权限被修改后的实时生效
- 临时权限到期后的访问限制

### 3. 数据一致性
- 题目删除后ACL记录处理
- 用户禁用后权限立即失效

## 📈 性能测试建议

### 1. 并发访问
- 多用户同时登录测试
- 大量题目查询性能

### 2. 权限计算
- 复杂权限查询响应时间
- 大量ACL记录查询优化

## 🎉 测试完成检查清单

- [ ] 所有测试账号都能正常登录
- [ ] 权限展开机制工作正常
- [ ] 题目访问控制准确
- [ ] 跨班级任课支持
- [ ] 临时权限管理
- [ ] 操作审计记录
- [ ] 统计信息准确
- [ ] 前端界面友好
- [ ] API接口稳定
- [ ] 数据库性能良好

---

## 🔧 故障排除

### 常见问题
1. **无法访问题目**: 检查ACL权限记录是否正确
2. **权限显示不全**: 验证用户组织关系表数据
3. **登录失败**: 确认用户状态为"正常"
4. **页面加载慢**: 检查数据库连接和查询性能

### 调试命令
```bash
# 检查Flask应用状态
ps aux | grep python

# 查看应用日志
# (在应用启动的终端查看)

# 重启应用
# Ctrl+C 停止，然后重新运行 python app.py
```

**🎯 开始测试吧！访问 http://localhost:8080 开始验证你的权限系统！** 